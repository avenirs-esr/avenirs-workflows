name: Common Backend Workflow

on:
  workflow_call:
    inputs:
      run_lint:
        type: boolean
        default: true
      run_security_scan:
        type: boolean
        default: true
      run_test_coverage:
        type: boolean
        default: true

jobs:
  lint:
    if: ${{ inputs.run_lint }}
    runs-on: ubuntu-latest
    steps:
      - name: ✅ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          ref: ${{ github.head_ref }}
      - name: 🔎 Lint code
        uses: avenirs-esr/avenirs-workflows/.github/actions/linting-scan@feat/core-actions-workflows

  security_scan:
    if: ${{ inputs.run_security_scan }}
    runs-on: ubuntu-latest
    steps:
      - name: ✅ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          ref: ${{ github.head_ref }}
      - name: 🔒 Security scan
        uses: avenirs-esr/avenirs-workflows/.github/actions/security-scan@feat/core-actions-workflows

  test_coverage:
    if: ${{ inputs.run_test_coverage }}
    runs-on: ubuntu-latest
    steps:
      - name: ✅ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          ref: ${{ github.head_ref }}
      - name: ⬆️ Grant execution permissions for Maven Wrapper
        run: chmod +x ./mvnw
      - name: 🧪 Run tests and generate coverage report
        uses: avenirs-esr/avenirs-workflows/.github/actions/unit-tests-and-code-coverage@feat/core-actions-workflows
        with:
          ignore_ssl_verification: "true"
          import_certificate_from_localhost: "false"
